---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import '../styles/global.css';
import { SEO } from 'astro-seo';
import { getSiteMetadata } from '../consts';

interface Props {
	title?: string;
	description?: string;
	articleMeta?: {
		publishedTime: Date;
		modifiedTime?: Date;
	};
}

const currentLocale = Astro.currentLocale || 'en';
const siteMetadata = getSiteMetadata(currentLocale);

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const {
	title = siteMetadata.title,
	description = siteMetadata.description,
	articleMeta,
} = Astro.props;

const siteTitle = siteMetadata.title;
const fullTitle = title === siteTitle ? siteTitle : `${title} â€¢ ${siteTitle}`;

const pathname = Astro.url.pathname;
const isPolish = pathname.startsWith('/pl/');

const [enPath, plPath] = isPolish
  // Polish page: remove /pl prefix for English version
  ? [pathname.replace(/^\/pl/, '') || '/', pathname]
  // English page: add /pl prefix for Polish version
  : [pathname, `/pl${pathname === '/' ? '' : pathname}`]

const languageAlternates = [
	{ hrefLang: 'en', href: new URL(enPath, Astro.site).href },
	{ hrefLang: 'pl', href: new URL(plPath, Astro.site).href },
	{ hrefLang: 'x-default', href: new URL(enPath, Astro.site).href },
];

const ogType = articleMeta ? 'article' : 'website';
const openGraphArticle = articleMeta
	? {
			publishedTime: articleMeta.publishedTime.toISOString(),
			modifiedTime: articleMeta.modifiedTime?.toISOString(),
		}
	: undefined;
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="sitemap" href="/sitemap-index.xml" />
<link
	rel="alternate"
	type="application/rss+xml"
	title={siteMetadata.title}
	href={new URL('rss.xml', Astro.site)}
/>
<meta name="generator" content={Astro.generator} />

<!-- Font preloads -->
<link rel="preload" href="/fonts/eb-garamond.woff" as="font" type="font/woff" crossorigin />
<link rel="preload" href="/fonts/eb-garamond-italic.woff" as="font" type="font/woff" crossorigin />
<link rel="preload" href="/fonts/league-spartan-vf.woff" as="font" type="font/woff" crossorigin />
<link rel="preload" href="/fonts/league-mono-vf.woff" as="font" type="font/woff" crossorigin />

<!-- SEO: title, description, canonical, Open Graph, Twitter, hreflang -->
<SEO
	title={fullTitle}
	description={description}
	canonical={canonicalURL.href}
	openGraph={{
		basic: {
			title: fullTitle,
			type: ogType,
			url: Astro.url.href,
			image: '',
		},
		optional: {
			description: description,
		},
		article: openGraphArticle,
	}}
	twitter={{
		card: 'summary_large_image',
		title: fullTitle,
		description: description,
	}}
	languageAlternates={languageAlternates}
/>

<link
	rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.css"
	integrity="sha384-WsHMgfkABRyG494OmuiNmkAOk8nhO1qE+Y6wns6v+EoNoTNxrWxYpl5ZYWFOLPCM"
	crossorigin="anonymous"
/>
